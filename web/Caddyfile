# ---- FRONT-END -------------------------------------------------
intelvis.ai, www.intelvis.ai {
	encode gzip zstd

	# serve Next.js frontend container
	reverse_proxy frontend:3000

	# proxy any /api/* request to backend
	handle_path /api/* {
		reverse_proxy backend:3001
		header Access-Control-Allow-Origin      *
		header Access-Control-Allow-Methods     "GET,POST,PUT,PATCH,DELETE,OPTIONS"
		header Access-Control-Allow-Headers     *
		header Access-Control-Allow-Credentials true
	}

	# pre-flight
	@options method OPTIONS
	respond @options 204
}

# ---- BACK-END (direct sub-domain) ------------------------------
api.intelvis.ai {
	encode gzip zstd

	reverse_proxy backend:3001

	header Access-Control-Allow-Origin      *
	header Access-Control-Allow-Methods     "GET,POST,PUT,PATCH,DELETE,OPTIONS"
	header Access-Control-Allow-Headers     *
	header Access-Control-Allow-Credentials true

	@options method OPTIONS
	respond @options 204
}
